import{j as e,c as p,a as y,d as x,Q as g}from"./Questionnaire.D9akWPmA.js";import{r as m}from"./index.CVf8TyFT.js";function j({onMatch:s}){const[n,l]=m.useState(""),c=a=>{a.preventDefault(),n.trim()&&s(n.trim())};return e.jsxs("form",{onSubmit:c,className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"hash-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter Partner's Soul Hash"}),e.jsx("input",{id:"hash-input",type:"text",value:n,onChange:a=>l(a.target.value),placeholder:"Paste hash here...",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-black focus:border-black",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full px-6 py-3 bg-black text-white font-medium rounded-md hover:bg-gray-800 transition-colors",children:"Start Matching"})]})}function N({result:s}){return e.jsxs("div",{className:"max-w-2xl mx-auto p-8 bg-white border border-gray-200 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Compatibility Report"}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-6",children:e.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-100"}),e.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:377,strokeDashoffset:377-377*s.compatibilityScore/100,className:"text-black transition-all duration-1000 ease-out"})]}),e.jsxs("span",{className:"absolute text-3xl font-bold",children:[s.compatibilityScore,"%"]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.summary})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Detailed Analysis"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:s.details})]})]})]})}const w=(s,n)=>{const l=p(s,n),c=y.map((a,r)=>{const t=s.answers[r],o=n.answers[r],h=a.options.find(i=>i.value===t),u=a.options.find(i=>i.value===o);return{id:a.id,dimension:a.dimension,question:a.text,A_answer:t,B_answer:o,A_label:h?.label||"N/A",B_label:u?.label||"N/A",difference:Math.abs(t-o)}});return{hostProfile:s,guestProfile:n,matchScore:l,comparisonMatrix:c}},S=s=>{const{matchScore:n,comparisonMatrix:l}=s,c=l.filter(t=>t.difference<=1),a=l.filter(t=>t.difference>=3);let r=`你是一位顶尖的、以数据驱动的“关系社会学家”。你的任务是根据两个人的50个维度问卷结果，生成一份客观、犀利、结构化的相性分析报告。两人基础匹配度为 ${n}%。请从三个维度（优势、雷区、长期建议）分析，并使用中文分点作答。`;return r+=`

--- 优势维度（Difference <= 1）：两人天然契合点 ---`,c.slice(0,5).forEach(t=>{r+=`
- [${t.dimension}]: Q.${t.id} (${t.question}) 两人答案几乎一致，A: ${t.A_label}, B: ${t.B_label}。`}),r+=`

--- 核心雷区（Difference >= 3）：未来潜在的冲突爆发点 ---`,a.slice(0,5).forEach(t=>{r+=`
- [${t.dimension}]: Q.${t.id} (${t.question}) 差异巨大 (A:${t.A_label} vs B:${t.B_label})。这是硬性矛盾，需要深入关注。`}),r+=`

--- 维度总结 ---`,r+=`

请根据上述数据和风格要求，生成报告的最终内容，报告应包含以下结构：
`,r+=`1. 核心结论（一句话总结，直指本质）
`,r+=`2. 关键优势分析（列点阐述）
`,r+=`3. 潜在雷区预警（列点阐述，语言要犀利）
`,r+=`4. 长期相处建议（给出可操作的策略）
`,r},v=async(s,n)=>{const l=w(s,n),c=S(l);return await new Promise(a=>setTimeout(a,1500)),{compatibilityScore:l.matchScore,summary:`基于数据的灵魂契合度：${l.matchScore}%`,details:`[System: This is a mock response. In production, the following prompt would be sent to the AI:]

${c}`}};function $(){const[s,n]=m.useState(null),[l,c]=m.useState(null),[a,r]=m.useState(!1),[t,o]=m.useState(null);m.useEffect(()=>{const d=new URLSearchParams(window.location.search).get("host");d&&(x(d)?n(d):o("无效的邀请链接或 Soul Hash 已损坏。"))},[]);const h=i=>{x(i)?(n(i),window.history.pushState({},"",`/match?host=${i}`),o(null)):o("无效的 Soul Hash，请检查后重试。")},u=async i=>{r(!0),o(null);try{if(s){const d=x(s),f=x(i);if(d&&f){const b=await v(d,f);c(b)}else o("解析 Soul Profile 失败，请重试。")}}catch(d){console.error(d),o("分析过程中发生错误，请稍后重试。")}finally{r(!1)}};return l?e.jsx(N,{result:l}):a?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-black mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"正在进行灵魂共鸣分析..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"AI 正在对比你们的 50 个维度数据"})]}):t?e.jsxs("div",{className:"max-w-md mx-auto mt-10 p-6 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"出错了"}),e.jsx("p",{className:"text-red-600 mb-4",children:t}),e.jsx("button",{onClick:()=>window.location.href="/match",className:"px-4 py-2 bg-white border border-red-300 text-red-700 rounded hover:bg-red-50 transition-colors",children:"返回重试"})]}):s?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center bg-gray-50 p-6 rounded-xl border border-gray-100",children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-black text-white rounded-full text-xs font-mono mb-3",children:"MATCHING MODE"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"对方已就位，请完成你的 Soul Profile"}),e.jsxs("p",{className:"text-gray-500 text-sm font-mono",children:["Target Hash: ",s.substring(0,12),"..."]})]}),e.jsx(g,{onComplete:u})]}):e.jsx(j,{onMatch:h})}export{$ as default};
