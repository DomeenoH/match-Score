import{j as e,c as j,Q as N,d as f,a as y}from"./Questionnaire.DbqaXciD.js";import{r as b}from"./index.CVf8TyFT.js";function w({onMatch:t}){const[a,l]=b.useState(""),c=r=>{r.preventDefault(),a.trim()&&t(a.trim())};return e.jsxs("form",{onSubmit:c,className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"hash-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter Partner's Soul Hash"}),e.jsx("input",{id:"hash-input",type:"text",value:a,onChange:r=>l(r.target.value),placeholder:"Paste hash here...",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-black focus:border-black",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full px-6 py-3 bg-black text-white font-medium rounded-md hover:bg-gray-800 transition-colors",children:"Start Matching"})]})}function v({result:t,hostInfo:a,guestInfo:l}){const c=(i,o,x)=>{const h=i.indexOf(o);if(h===-1)return null;let d="";if(x){const m=i.indexOf(x);m!==-1?d=i.substring(h+o.length,m).trim():d=i.substring(h+o.length).trim()}else d=i.substring(h+o.length).trim();return d.replace(/^[:ï¼š\n]+/,"").trim()},r=t.details,n=c(r,"--- ä¼˜åŠ¿ç»´åº¦ï¼ˆDifference <= 1ï¼‰ï¼šä¸¤äººå¤©ç„¶å¥‘åˆç‚¹ ---","--- æ ¸å¿ƒé›·åŒº"),s=c(r,"--- æ ¸å¿ƒé›·åŒºï¼ˆDifference >= 3ï¼‰ï¼šæœªæ¥æ½œåœ¨çš„å†²çªçˆ†å‘ç‚¹ ---","--- ç»´åº¦æ€»ç»“"),u=i=>i?e.jsx("ul",{className:"space-y-3",children:i.split(`
`).map((o,x)=>{const h=o.trim();return!h||h.startsWith("---")?null:e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 mt-1.5 h-1.5 w-1.5 flex-shrink-0 rounded-full bg-current opacity-60"}),e.jsx("span",{className:"text-sm leading-relaxed",children:h.replace(/^- /,"")})]},x)})}):e.jsx("p",{className:"text-gray-500 italic",children:"æš‚æ— æ˜¾è‘—æ•°æ®"});return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 sm:p-10 bg-white border border-gray-200 rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 text-xs font-mono text-gray-400 border-b border-gray-100 pb-4",children:[e.jsxs("div",{children:["HOST: ",a||"Unknown"]}),e.jsxs("div",{children:["GUEST: ",l||"Unknown"]})]}),e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 mb-2",children:"çµé­‚å¥‘åˆåº¦åˆ†ææŠ¥å‘Š"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"åŸºäº 50 ç»´åº¦æ·±åº¦æ¯”å¯¹ç®—æ³•"}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-8 relative",children:e.jsxs("div",{className:"relative w-40 h-40 flex items-center justify-center",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"#f3f4f6",strokeWidth:"12",fill:"transparent"}),e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"currentColor",strokeWidth:"12",fill:"transparent",strokeDasharray:440,strokeDashoffset:440-440*t.compatibilityScore/100,className:"text-black transition-all duration-1000 ease-out",strokeLinecap:"round"})]}),e.jsxs("div",{className:"absolute flex flex-col items-center",children:[e.jsxs("span",{className:"text-5xl font-black tracking-tighter",children:[t.compatibilityScore,"%"]}),e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mt-1",children:"Match"})]})]})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-900 text-white p-8 rounded-xl shadow-lg transform hover:scale-[1.01] transition-transform",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ğŸ’¡"})," æ ¸å¿ƒç»“è®º"]}),e.jsx("p",{className:"text-lg leading-relaxed font-medium opacity-90",children:t.summary})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-green-50 p-6 rounded-xl border border-green-100",children:[e.jsxs("h3",{className:"text-green-800 font-bold mb-4 flex items-center",children:[e.jsx("span",{className:"bg-green-200 text-green-800 p-1 rounded mr-2 text-xs",children:"MATCH"}),"å…³é”®ä¼˜åŠ¿"]}),e.jsx("div",{className:"text-green-900",children:u(n)})]}),e.jsxs("div",{className:"bg-red-50 p-6 rounded-xl border border-red-100",children:[e.jsxs("h3",{className:"text-red-800 font-bold mb-4 flex items-center",children:[e.jsx("span",{className:"bg-red-200 text-red-800 p-1 rounded mr-2 text-xs",children:"CONFLICT"}),"æ½œåœ¨é›·åŒº"]}),e.jsx("div",{className:"text-red-900",children:u(s)})]})]}),e.jsxs("div",{className:"bg-blue-50 p-8 rounded-xl border border-blue-100",children:[e.jsx("h3",{className:"text-blue-900 font-bold mb-4",children:"ğŸ”® é•¿æœŸç›¸å¤„å»ºè®®"}),e.jsxs("p",{className:"text-blue-800 leading-relaxed",children:["(æ­¤å¤„å°†æ˜¾ç¤º AI ç”Ÿæˆçš„è¯¦ç»†å»ºè®®ã€‚å½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ï¼Œå±•ç¤ºçš„æ˜¯ Prompt ä¸­çš„åŸå§‹æ•°æ®ç»“æ„ã€‚)",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"text-xs opacity-50 font-mono block mt-4 border-t border-blue-200 pt-4",children:"Debug Info: Raw Prompt Data Available"})]})]})]}),e.jsx("div",{className:"mt-12 text-center",children:e.jsx("button",{onClick:()=>window.location.href="/",className:"px-8 py-3 bg-white border-2 border-black text-black font-bold rounded-lg hover:bg-gray-50 transition-colors",children:"è¿”å›é¦–é¡µ"})})]})}const S=(t,a)=>{const l=j(t,a),c=N.map((r,n)=>{const s=t.answers[n],u=a.answers[n],i=r.options.find(x=>x.value===s),o=r.options.find(x=>x.value===u);return{id:r.id,dimension:r.dimension,question:r.text,A_answer:s,B_answer:u,A_label:i?.label||"N/A",B_label:o?.label||"N/A",difference:Math.abs(s-u)}});return{hostProfile:t,guestProfile:a,matchScore:l,comparisonMatrix:c}},k=t=>{const{matchScore:a,comparisonMatrix:l}=t,c=l.filter(s=>s.difference<=1),r=l.filter(s=>s.difference>=3);let n=`ä½ æ˜¯ä¸€ä½é¡¶å°–çš„ã€ä»¥æ•°æ®é©±åŠ¨çš„â€œå…³ç³»ç¤¾ä¼šå­¦å®¶â€ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸¤ä¸ªäººçš„50ä¸ªç»´åº¦é—®å·ç»“æœï¼Œç”Ÿæˆä¸€ä»½å®¢è§‚ã€çŠ€åˆ©ã€ç»“æ„åŒ–çš„ç›¸æ€§åˆ†ææŠ¥å‘Šã€‚ä¸¤äººåŸºç¡€åŒ¹é…åº¦ä¸º ${a}%ã€‚è¯·ä»ä¸‰ä¸ªç»´åº¦ï¼ˆä¼˜åŠ¿ã€é›·åŒºã€é•¿æœŸå»ºè®®ï¼‰åˆ†æï¼Œå¹¶ä½¿ç”¨ä¸­æ–‡åˆ†ç‚¹ä½œç­”ã€‚`;return n+=`

--- ä¼˜åŠ¿ç»´åº¦ï¼ˆDifference <= 1ï¼‰ï¼šä¸¤äººå¤©ç„¶å¥‘åˆç‚¹ ---`,c.slice(0,5).forEach(s=>{n+=`
- [${s.dimension}]: Q.${s.id} (${s.question}) ä¸¤äººç­”æ¡ˆå‡ ä¹ä¸€è‡´ï¼ŒA: ${s.A_label}, B: ${s.B_label}ã€‚`}),n+=`

--- æ ¸å¿ƒé›·åŒºï¼ˆDifference >= 3ï¼‰ï¼šæœªæ¥æ½œåœ¨çš„å†²çªçˆ†å‘ç‚¹ ---`,r.slice(0,5).forEach(s=>{n+=`
- [${s.dimension}]: Q.${s.id} (${s.question}) å·®å¼‚å·¨å¤§ (A:${s.A_label} vs B:${s.B_label})ã€‚è¿™æ˜¯ç¡¬æ€§çŸ›ç›¾ï¼Œéœ€è¦æ·±å…¥å…³æ³¨ã€‚`}),n+=`

--- ç»´åº¦æ€»ç»“ ---`,n+=`

è¯·æ ¹æ®ä¸Šè¿°æ•°æ®å’Œé£æ ¼è¦æ±‚ï¼Œç”ŸæˆæŠ¥å‘Šçš„æœ€ç»ˆå†…å®¹ï¼ŒæŠ¥å‘Šåº”åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š
`,n+=`1. æ ¸å¿ƒç»“è®ºï¼ˆä¸€å¥è¯æ€»ç»“ï¼Œç›´æŒ‡æœ¬è´¨ï¼‰
`,n+=`2. å…³é”®ä¼˜åŠ¿åˆ†æï¼ˆåˆ—ç‚¹é˜è¿°ï¼‰
`,n+=`3. æ½œåœ¨é›·åŒºé¢„è­¦ï¼ˆåˆ—ç‚¹é˜è¿°ï¼Œè¯­è¨€è¦çŠ€åˆ©ï¼‰
`,n+=`4. é•¿æœŸç›¸å¤„å»ºè®®ï¼ˆç»™å‡ºå¯æ“ä½œçš„ç­–ç•¥ï¼‰
`,n},A=async(t,a)=>{const l=S(t,a),c=k(l);return await new Promise(r=>setTimeout(r,1500)),{compatibilityScore:l.matchScore,summary:`åŸºäºæ•°æ®çš„çµé­‚å¥‘åˆåº¦ï¼š${l.matchScore}%`,details:`[System: This is a mock response. In production, the following prompt would be sent to the AI:]

${c}`}};function H(){const[t,a]=b.useState(null),[l,c]=b.useState(null),[r,n]=b.useState(null),[s,u]=b.useState(!1),[i,o]=b.useState(null);b.useEffect(()=>{const m=new URLSearchParams(window.location.search).get("host");m&&(f(m)?a(m):o("æ— æ•ˆçš„é‚€è¯·é“¾æ¥æˆ– Soul Hash å·²æŸåã€‚"))},[]);const x=d=>{f(d)?(a(d),window.history.pushState({},"",`/match?host=${d}`),o(null)):o("æ— æ•ˆçš„ Soul Hashï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚")},h=async d=>{c(d),u(!0),o(null);try{if(t){const m=f(t),p=f(d);if(m&&p){const g=await A(m,p);n(g)}else o("è§£æ Soul Profile å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚")}}catch(m){console.error(m),o("åˆ†æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚")}finally{u(!1)}};return r?e.jsx(v,{result:r,hostInfo:t?t.substring(0,8)+"...":void 0,guestInfo:l?l.substring(0,8)+"...":void 0}):s?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-black mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"æ­£åœ¨è¿›è¡Œçµé­‚å…±é¸£åˆ†æ..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"AI æ­£åœ¨å¯¹æ¯”ä½ ä»¬çš„ 50 ä¸ªç»´åº¦æ•°æ®"})]}):i?e.jsxs("div",{className:"max-w-md mx-auto mt-10 p-6 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"å‡ºé”™äº†"}),e.jsx("p",{className:"text-red-600 mb-4",children:i}),e.jsx("button",{onClick:()=>window.location.href="/match",className:"px-4 py-2 bg-white border border-red-300 text-red-700 rounded hover:bg-red-50 transition-colors",children:"è¿”å›é‡è¯•"})]}):t?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center bg-gray-50 p-6 rounded-xl border border-gray-100",children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-black text-white rounded-full text-xs font-mono mb-3",children:"MATCHING MODE"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"å¯¹æ–¹å·²å°±ä½ï¼Œè¯·å®Œæˆä½ çš„ Soul Profile"}),e.jsxs("p",{className:"text-gray-500 text-sm font-mono",children:["Target Hash: ",t.substring(0,12),"..."]})]}),e.jsx(y,{onComplete:h})]}):e.jsx(w,{onMatch:x})}export{H as default};
